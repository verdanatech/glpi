/**
 * ---------------------------------------------------------------------
 *
 * GLPI - Gestionnaire Libre de Parc Informatique
 *
 * http://glpi-project.org
 *
 * @copyright 2015-2022 Teclib' and contributors.
 * @copyright 2003-2014 by the INDEPNET Development Team.
 * @licence   https://www.gnu.org/licenses/gpl-3.0.html
 *
 * ---------------------------------------------------------------------
 *
 * LICENSE
 *
 * This file is part of GLPI.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 *
 * ---------------------------------------------------------------------
 */
var x_before_drag=0;var y_before_drag=0;var dirty=false;var initRack=function(){$(document).on("click","#sviewlist",(function(){$("#viewlist").show();$("#viewgraph").hide();$(this).addClass("selected");$("#sviewgraph").removeClass("selected")})).on("click","#sviewgraph",(function(){$("#viewlist").hide();$("#viewgraph").show();$(this).addClass("selected");$("#sviewlist").removeClass("selected")})).on("click","#toggle_images",(function(){$("#toggle_text").toggle();$(this).toggleClass("active");$("#viewgraph").toggleClass("clear_picture")})).on("click","#toggle_text",(function(){$(this).toggleClass("active");$("#viewgraph").toggleClass("clear_text")})).on("click",".cell_add",(function(){var t=grid_rack_units-$(this).index();var e=$(this).parents(".rack_side").hasClass("rack_front")?0:1;glpi_ajax_dialog({url:grid_link_url,method:"get",dialogclass:"modal-xl",params:{racks_id:grid_rack_id,orientation:e,position:t,ajax:true}})})).on("click","#add_pdu",(function(t){t.preventDefault();glpi_ajax_dialog({title:__("Add PDU"),url:grid_item_ajax_url,method:"get",dialogclass:"modal-xl",params:{racks_id:grid_rack_id,action:"show_pdu_form",ajax:true}})}));let t=GridStack.initAll({cellHeight:21,margin:0,marginBottom:1,float:true,disableOneColumnMode:true,animate:true,removeTimeout:100,disableResize:true});t.forEach((function(t){var e=$(t.el).hasClass("side_pdus_graph");t.on("dragstart",(function(t){var e=$(t.target);x_before_drag=Number(e.attr("gs-x"));y_before_drag=Number(e.attr("gs-y"));e.qtip("hide",true)})).on("change",(function(a,r){if(dirty){return}var i=$(t.el).parents(".racks_col").hasClass("rack_rear");$.each(r,(function(a,r){var s=$(r.el);var d=s.hasClass("half_rack");var l=grid_rack_units-s.attr("gs-y")-s.attr("gs-h")+1;$.post(grid_item_ajax_url,{id:r.id,action:e?"move_pdu":"move_item",position:l,hpos:getHpos(s.attr("gs-x"),d,i)},(function(e){if(!e.status){dirty=true;t.update(r.el,{x:x_before_drag,y:y_before_drag});dirty=false;displayAjaxMessageAfterRedirect()}else{var a=s.hasClass("item_rear")?"item_front":"item_rear";var i=$(".grid-stack-item."+a+"[gs-id="+s.attr("gs-id")+"]");if(i.length){var d=GridStack.init({},$(i).closest(".grid-stack")[0]);var l=parseInt(s.attr("gs-x"));var n=parseInt(s.attr("gs-y"));if(s.attr("gs-w")==1){l=s.attr("gs-x")==0?1:0}dirty=true;d.update(i[0],{x:l,y:n});dirty=false}}})).fail((function(){dirty=true;t.update(r.el,{x:x_before_drag,y:y_before_drag});dirty=false;displayAjaxMessageAfterRedirect()}))}))})).on("dragstart",(function(t){var e=$(t.target);x_before_drag=Number(e.attr("gs-x"));y_before_drag=Number(e.attr("gs-y"));e.qtip("hide",true)}))}));$("#viewgraph .cell_add, #viewgraph .grid-stack-item").each((function(){var t=$(this).find(".tipcontent");if(t.length){$(this).qtip({position:{my:"left center",at:"right center"},content:{text:t},style:{classes:"qtip-shadow qtip-bootstrap rack_tipcontent"}})}}));for(var e=grid_rack_units;e>=1;e--){$(".indexes").append("<li>"+e+"</li>");$(".racks_add").append('<div class="cell_add"><span class="tipcontent">'+grid_rack_add_tip+"</span></div>")}};var getHpos=function(t,e,a){if(!e){return 0}else if(t==0&&!a){return 1}else if(t==0&&a){return 2}else if(t==1&&a){return 1}else if(t==1&&!a){return 2}};